function [Y,Xf,Af] = testMatcherTrackletJoinerANN(X,~,~)
%TESTMATCHERTRACKLETJOINERANN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 15-Jul-2014 16:15:06.
% 
% [Y] = testMatcherTrackletJoinerANN(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 102xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_remove = [2 13 14 15 16 22 23 24 30 31 32 33 38 43 48 53 58 73 78 83 88 100];
  x1_step1_keep = [1 3 4 5 6 7 8 9 10 11 12 17 18 19 20 21 25 26 27 28 29 34 35 36 37 39 40 41 42 44 45 46 47 49 50 51 52 54 55 56 57 59 60 61 62 63 64 65 66 67 68 69 70 71 72 74 75 76 77 79 80 81 82 84 85 86 87 89 90 91 92 93 94 95 96 97 98 99 101 102];
  x1_step2_xoffset = [0;0;0;0;0;0;0;0;0;0;0;0.00103445281274617;6.48368804831989e-05;0;0;0;0;8.4140534454491e-05;0;0;0;0;0;0;0;0;0;0.000100116085377522;0;0;0;0;0;0;0;0;0;0;0;2.85292771877721e-05;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
  x1_step2_gain = [0.0158730158730159;2.90652540942163;2.03903119980195;2.37150437482998;2.2661917770324;2.66934324134796;4.09202785577281;5.75577139277445;14.1680537808242;36.8282492984315;181.306368811454;2.15478083754764;3.23228997263057;3.04179628476663;20.0758560709365;110.326792142022;2.16176805791407;2.68207171871639;2.11370854694141;8.15287624578416;100.697570935707;13.8082107673563;6.90410538367816;4.82182539825101;4.70345078352224;15.7797336681048;7.03562333417449;5.47872782083008;6.26276490399498;12.4365055700217;7.03562333417449;5.09501548573835;6.89347525784972;10.4642249520557;6.49999975785614;5.14241607225711;7.44983228435196;14.7648223857065;6.24499828680726;4.72973190626954;6.65732687383463;16.0277532493858;6.90410538367816;5.20816675480318;4.58257560677817;43.3589677406016;13.8082107673563;7.45117477070123;6.19349027404374;4.87339729252091;43.3589677406016;12.020815295909;7.46190306544748;5.30690742346193;7.03562333417449;10.8397419351504;6.97614960544222;5.93158261916995;9.91071258210701;12.4365055700217;5.42627363533498;5.25873755877293;6.19677356028073;14.071246668349;6.05530078327738;5.16397764900917;6.892024659714;11.4891250363589;6.21825278501086;5.16397764900917;5.3604750015596;2;2;2;2;2;2;2;0.0229885057471264;0.0217391304347826];
  x1_step2_ymin = -1;
  
  % Layer 1
  b1 = [-0.44324323410513710719;0.077032565774963507321;0.0078180459076082706865;-0.39843576092947868839];
  IW1_1 = [0.28030367640523484729 0.31439128132634791557 -0.44554918243734664696 0.027428662090267418028 -0.23739817512154234858 -0.23269840511896758284 0.035694928770579781308 0.25551785518214981119 0.30233135488562012938 0.44068844550899727297 0.3201264999609617079 -0.30370679617342116741 -0.05985274148230470409 0.079965290862948859574 0.21661347430640098821 0.38919784497165332837 -0.50703915387510001267 0.09316955589655324943 0.037536647433823670805 0.2733154908108886838 0.24174037923404101402 0.37012524993934170503 0.227570732134885656 0.29717288367712679786 -0.050371336655610991773 0.29273550885465277061 0.063629256276481541144 0.25646353180850928188 0.16266512596165053073 -0.32589017797491115491 0.056484774773688552207 0.069851861865593015133 0.18387398147002217974 -0.13917957420428200832 0.08349154450563806007 -0.10934080201332474491 0.2818533252669159217 0.11201962850876609479 0.048418636446154093844 0.053716638098948346625 0.085836941641315042673 0.66809974606542921194 -0.056012275716835507877 0.13153385574078579889 -0.011653587439493188344 0.56566926606655953957 0.53715411910277532925 0.043954571925291979761 0.15029949713201876116 0.16710982007471092414 0.34539601236152178698 0.44905120833804124114 0.034713471697700282181 0.18501606375037268903 0.17059513999243647309 0.15924740927641900523 0.19821649031503868477 -0.026680069546135554148 0.15111738307905020484 0.081384544069873790417 0.080558023183940716261 0.1564998642033132159 0.2080465536785136571 -0.053503088265126182155 0.18330471484299687424 0.11442906261014365588 0.10801997919087243105 0.18049381079066276201 0.22418699249391796369 0.22960101754045242339 0.19543440903030007139 -0.020667985192176552278 0.075067511547050380649 0.16068642486973044869 0.24177950694856342739 0.46591902151265290888 0.10909840906194477606 0.3564777902359765327 -0.11124239410218760005 -0.9806830032602539271;-0.12883053984689121774 -0.10238349496546626793 0.16449796977822694899 -0.055841145693572152853 0.05666121516284605697 0.12298845740547244276 -0.0043729717159823201095 -0.071405465695712516672 -0.092985728119324234653 -0.14604135517742494743 -0.013606200441449984792 0.10191604102026745327 -0.0075052700315034991119 0.0074863777859010610313 -0.024205400060229864678 -0.23125578624821610529 0.12865787347491688952 -0.032237739349606393813 0.033910412786448358713 -0.058278195188456768938 -0.25299795668457814024 -0.043874233073463365928 -0.10690528938017065941 -0.1188991853771288465 -0.14341409008603306363 0.013402495843970947328 0.011708579607571455161 -0.021847709379045565647 0.037207518335095945972 0.0060625450845000934674 -0.1964962770123227509 -0.092996023000676344972 -0.11141619906372836335 -0.038984672700246650323 -0.06704547715010024389 -0.08267024888392907056 -0.19991309955161695733 -0.076598804606244741411 -0.044396166039764602129 -0.022629884364292994492 -0.027938978678058924709 -0.197070545346552356 -0.023917472757636303038 0.080712821218084596087 -0.046805288469793357442 -0.16568150262651148985 -0.16591683884412655736 0.094092943564851955207 0.028569497114575324176 0.039491575626913376362 -0.057130123444856836801 -0.083298912286840789965 0.050333231633886976741 0.055331119700668687789 0.0090390371941115391086 -0.029027494195016625284 0.047247619878852044339 -0.050723711818322490819 0.030476573901743547745 -0.01429749241621347533 0.035600865183948782189 -0.10106407089751424933 0.068585733418006833428 0.03527262877268914909 0.023561535762299391783 0.0019088709656965032434 -0.055952161074399993368 -0.022619107078355942669 -0.014808958475743859776 -0.064833602783641697265 -0.005328674845723347514 0.19979774645881601125 -0.11843966083865788141 -0.12852137575825409166 0.030285483830328030486 -0.16488888135035309479 -0.30864128572323995536 0.087425705521713373281 -0.038928492923011967508 0.21394600208480488157;0.12824474630285001564 0.28613012952032379488 -0.089897948609938438391 0.076609214152365240347 0.041047490217653997968 -0.14475068024578721659 0.026902942573969208101 0.089458563444317698576 0.089173927683590281656 0.074799022076674326343 0.0095045774432850615998 0.019046724695300932401 0.095275932742170707512 -0.0095162266978809206125 0.072063202670607159894 0.15228973904433779074 -0.0527286472996268199 0.099219487507930248515 0.027452309690016222371 0.134998343895842976 0.20241211355717703135 0.14138039061662946438 0.0067324029555048577056 0.14549475076284537622 0.19644259897047436358 -0.1196356166515376851 0.040798958654595984807 -0.12462172968087341374 0.19469753826560795562 -0.0268614341585630724 0.12708877350981850896 0.10605642907091016036 0.085625658287009409619 0.14403788099565240088 -0.013444158692050079892 0.20255043549411624881 0.13496201454677625442 0.14001366795843858681 0.007776151905975030483 -0.012130400260380315783 0.044371881605676150029 0.0210212319971369542 0.13812707519436898118 0.0074503671015647126435 0.21564604844916199222 0.041293710031859165444 0.1213960737556269015 -0.13746377554900202078 -0.097046449314083640947 -0.15167326843693570981 0.24378140428261835249 -0.082187711215015932242 -0.22359575442315884897 -0.01327408418952651277 -0.076621104246318141873 -0.059988451014862935462 -0.08898204567892474548 0.0029661035136635286943 0.11484340056241064409 0.11358965219136202274 0.0065562711310602561979 0.12372488120273070211 0.010555727902762351844 0.17840291370990390973 -0.045579627291711187487 0.062803924132574823203 0.077751040474728833063 0.027632873042555159554 -0.069365983381624932158 0.0025270738009227577091 -0.0079240690919828004474 0.039064867904066942483 -0.087617927334850534415 0.091057783427934926856 0.033045013987784768728 0.14790229532805346246 0.26704932270765119329 0.067367732452071435456 -0.0040764924460007624998 -0.24503319540654144859;-0.026292513473633476184 0.17467213108741758143 -0.23188759451052037841 0.24307856960717738604 -0.0085232512626789089238 -0.21966188532177105541 -0.15262350026132162628 -0.0046567498460080214082 0.08185766336452418579 0.21883475078138922565 0.071085899539524002866 0.010129162161647112944 0.13856200317320213622 0.030896931541632366436 -0.01398145443897453287 0.17720169976801192213 -0.53810783447352672493 0.13675121774868972957 -0.019128137169523544425 0.065218130308717911503 -0.01220463150091978359 0.19469139257852724478 0.016337853128696157301 0.05480439699803953818 0.11052708267163555145 0.21354758333695944561 -0.39198563289137211552 0.096528931412588073191 -0.02937868030376871234 -0.18352662033708908029 -0.071931809684268210869 -0.08740355649841881347 0.091975484799150603044 0.12387416904107796667 0.10461986828902899993 0.1379565663322294411 0.10284987270726647646 0.095473755926464842769 0.1970214368590575138 -0.041762566402912204566 0.090502289476810271474 0.063099610670129868684 0.008902337091259112864 -0.067825003789935597864 -0.030280702267407484662 -0.3334615107399639955 0.062916617367427513097 -0.0016044060369891310035 -0.064582199204882242971 -0.085565618151776726141 0.035036923221079575852 0.16633970330668323978 -0.62969767612562710379 -0.2873734288167201778 0.17746072489570599573 0.069245561964854401849 0.11733216286340629464 0.10314313995448537442 0.14793362445000868277 0.17423016785129044615 0.041651200428710379031 0.11054924176988792373 0.091448421536855811764 -0.11280398580976783163 0.0022953274942393163578 -0.093012872662605813878 0.24206892910208438474 -0.01692882778278965647 -0.027067147184777630431 -0.031254660231686770544 0.012559965443117007688 0.01257566684550873691 0.040806472930719817072 -0.036683564628269944852 -0.34387375558936955633 0.032144251319526362387 0.36117300824337067455 0.10782854016128567975 -0.63229823211192415222 -2.9927902142008582231];
  
  % Layer 2
  b2 = -1.4737211455572898355;
  LW2_1 = [0.68050768953200069245 0.10230960839337131796 0.78375673457769812202 6.0404857775095841532];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 2;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1_keep,x1_step1_remove);
    Xp1 = mapminmax_apply(temp,x1_step2_gain,x1_step2_xoffset,x1_step2_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings_keep,settings_remove)
  if isempty(settings_remove)
    y = x;
  else
    y = x(settings_keep,:);
  end
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
  a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
